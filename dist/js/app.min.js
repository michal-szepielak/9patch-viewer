var ImageLoader=function(){"use strict";function a(a,b){b.stopPropagation(),a.showDropZone(!0),p&&(window.clearTimeout(p),p=null),p=setTimeout(function(){a.hiddenInput.click(),n=!0},400)}function b(a,b){b.stopPropagation(),b.target&&b.target.files&&b.target.files[0]&&a.readFile(b.target.files[0])}function c(a,b){a.setLoaderState("error"),a.onError(b)}function d(a){a.setProgress(0)}function e(a,b){var c,d=b.target;d.readyState===FileReader.DONE&&(a.setProgress(100),c=new Image,c.src=d.result,a.setLoaderState(m.SUCCESS),a.onImageLoad(c))}function f(a,b){a.setProgress(Math.round(b.loaded/b.total*100))}function g(a){n&&(a.hideDropZone(),n=!1)}function h(a){return a.preventDefault(),!1}function i(a,b){return b.preventDefault(),0===l.length&&(o||a.showDropZone(),o=!0),l.indexOf(b.target)<0&&l.push(b.target),!1}function j(a,b){var c;return b.preventDefault(),c=l.indexOf(b.target),c>=0&&l.splice(c,1),0===l.length&&(o&&a.hideDropZone(),o=!1),!1}function k(a,b){return b.preventDefault(),o&&a.hideDropZone(),o=!1,l=[],b.dataTransfer&&b.dataTransfer.files&&b.dataTransfer.files[0]&&a.readFile(b.dataTransfer.files[0]),!1}var l=[],m={SUCCESS:"green",ERROR:"red",IDLE:""},n=!1,o=!1,p=null,q=null,r=function(a,b,c){return a.element?a.dropZoneContainer?a.documentMain?(this.eventBounds=null,this.hiddenInput=null,this.fileReader=new FileReader,this.onImageLoad=b||function(){return!1},this.onError=c||function(){return!1},this.ui=a,this.ui.clonedMain=null,this):void console.warn("Couldn't bind ImageLoader to documentMain!"):void console.warn("Couldn't bind ImageLoader to dropZoneContainer!"):void console.warn("Couldn't bind ImageLoader to element!")};return r.prototype.init=function(){this.build(),this.bindEvents()},r.prototype.setProgress=function(a){this.setLoaderState("progress",10*Math.floor(a/10))},r.prototype.setLoaderState=function(a,b){var c;switch(a=a.toLowerCase()){case"idle":case"error":case"success":c=a;break;case"progress":c=a+"-"+b;break;default:c=""}this.ui.element.className="btn "+c},r.prototype.build=function(){var a=document.createElement("input");a.type="file",a.accept=".png",this.hiddenInput=a},r.prototype.bindEvents=function(){var l=this.fileReader,m={windowFocus:g.bind(null,this),elementClick:a.bind(null,this),fileChange:b.bind(null,this),fileReadAbort:c.bind(null,this),fileReadError:c.bind(null,this),fileReadLoadStart:d.bind(null,this),fileReadLoad:e.bind(null,this),fileReadProgress:f.bind(null,this),onDragOver:h.bind(null),onDragEnter:i.bind(null,this),onDragLeave:j.bind(null,this),onDrop:k.bind(null,this)};this.ui.element.addEventListener("click",m.elementClick,!0),this.hiddenInput.addEventListener("change",m.fileChange,!0),l.addEventListener("abort",m.fileReadAbort,!1),l.addEventListener("error",m.fileReadError,!1),l.addEventListener("loadstart",m.fileReadLoadStart,!1),l.addEventListener("load",m.fileReadLoad,!1),l.addEventListener("progress",m.fileReadProgress,!1),window.addEventListener("focus",m.windowFocus,!1),window.addEventListener("dragover",m.onDragOver,!0),window.addEventListener("dragenter",m.onDragEnter,!0),window.addEventListener("dragleave",m.onDragLeave,!0),document.addEventListener("drop",m.onDrop,!0),this.eventBounds=m},r.prototype.unbindEvents=function(){var a=this.fileReader,b=this.eventBounds;this.ui.element.removeEventListener("click",b.elementClick,!0),this.hiddenInput.removeEventListener("change",b.fileChange,!0),a.removeEventListener("abort",b.fileReadAbort,!1),a.removeEventListener("error",b.fileReadError,!1),a.removeEventListener("loadstart",b.fileReadLoadStart,!1),a.removeEventListener("load",b.fileReadLoad,!1),a.removeEventListener("progress",b.fileReadProgress,!1),window.removeEventListener("focus",b.windowFocus,!1),window.removeEventListener("dragover",b.onDragOver,!0),window.removeEventListener("dragenter",b.onDragEnter,!0),window.removeEventListener("dragleave",b.onDragLeave,!0),document.removeEventListener("drop",b.onDrop,!0),this.eventBounds=null},r.prototype.showDropZone=function(a){var b=this.ui,c=b.documentMain,d=b.clonedMain||c.cloneNode(!0),e=b.dropZoneContainer;a=!!a,c.classList.add("hidden"),d.classList.add("clonned"),q&&(window.clearTimeout(q),q=null),a||e.classList.remove("hidden"),c.parentElement.insertBefore(d,e),window.getComputedStyle(d).filter&&(d.classList.add("blurred"),e.classList.add("faded")),b.clonedMain=d},r.prototype.hideDropZone=function(){var a=this.ui,b=a.documentMain,c=a.clonedMain,d=a.dropZoneContainer;c.classList.remove("blurred"),d.classList.remove("faded"),q&&(window.clearTimeout(q),q=null),q=setTimeout(function(){c.parentElement.removeChild(c),b.classList.remove("hidden"),d.classList.add("hidden"),a.clonedMain=null},400)},r.prototype.readFile=function(a){var b=this.fileReader;b.readyState===FileReader.LOADING&&b.abort(),a&&b.readAsDataURL(a)},r.prototype.destroy=function(){this.unbindEvents(),this.hiddenInput=null,this.ui=null},r}(),NinePatch=function(){"use strict";function a(a){var b,c,d,e,f,g,h=a.data,i=[],j=null,k=null,l=h.length;for(b=4;l-4>b;b+=4)c=h[b],d=h[b+1],e=h[b+2],f=h[b+3],j=0===c&&0===d&&0===e&&255===f,j!==k&&(g&&i.push(g),g={start:null,stop:null,size:null,flexible:!1}),null===g.start&&(g.start=b/4,g.size=0,g.flexible=j),g.stop=b/4+1,g.size++,k=j;return g&&i.push(g),i}function b(a,b){var c,d=document.createElement("canvas"),e=d.getContext("2d");return d.width=b.sw,d.height=b.sh,c=a.getImageData(b.sx,b.sy,b.sw,b.sh),e.putImageData(c,0,0),d.toDataURL("image/png")}var c=function(a,b){this.canvas=null,this.previewContainer=b,this.contentRulers=null,this.createPreviewFromImage(a)};return c.prototype.createContentRulersBox=function(){var a=document.createElement("table"),b=this.previewContainer;return a.innerHTML='<tr><td colspan="3"></td></tr><tr><td colspan="3"></td></tr><tr><td></td><td></td><td></td></tr>',a.className="content-rulers",b.appendChild(a),a},c.prototype.createPreviewFromImage=function(a){var b;this.contentRulers=this.createContentRulersBox(),this.canvas=this.createCanvasFromImage(a),b=this.getGridInfo(),this.createGrid(b.verticalStretches,b.horizontalStretches),this.setupContent(b.horizontalPadding,b.verticalPadding)},c.prototype.getGridInfo=function(){var b,c,d,e,f;return b=this.canvas,c=b.getContext("2d"),e=b.width,f=b.height,d={top:c.getImageData(0,0,e,1),bottom:c.getImageData(0,f-1,e,1),left:c.getImageData(0,0,1,f),right:c.getImageData(e-1,0,1,f)},{horizontalStretches:a(d.top),verticalStretches:a(d.left),horizontalPadding:a(d.bottom),verticalPadding:a(d.right)}},c.prototype.createCanvasFromImage=function(a){var b,c,d,e=document.createElement("canvas");return b=a.naturalWidth,c=a.naturalHeight,e.width=b,e.height=c,d=e.getContext("2d"),d.drawImage(a,0,0),e},c.prototype.createCells=function(a,c){var d,e,f,g,h,i=document.createDocumentFragment();for(h=0;h<a.length;h++)e=a[h],g=document.createElement("td"),e.flexible?g.classList.add("flexible"):(g.style.width=e.size+"px",g.style.minWidth=e.size+"px"),f={sx:e.start,sy:c.start,sw:e.size,sh:c.size},d=this.canvas.getContext("2d"),g.style.backgroundImage="url("+b(d,f)+")",i.appendChild(g);return i},c.prototype.createGrid=function(a,b){var c,d,e,f,g,h=document.createDocumentFragment(),i=0;for(g=0;g<a.length;g++)c=a[g],e=document.createElement("tr"),c.flexible?e.classList.add("flexible"):(e.style.height=c.size+"px",e.style.minHeight=c.size+"px"),d=this.createCells(b,c),e.appendChild(d),h.appendChild(e),f=this.getRowMinWidth(e),f>i&&(i=f);e=document.createElement("table"),e.className="tiles",e.appendChild(h),this.previewContainer.appendChild(e),this.previewContainer.style.minWidth=i+5+"px"},c.prototype.getRowMinWidth=function(a){var b,c,d=0,e=a.children;for(b=0;b<e.length;b++)c=e[b].style.minWidth,c&&(c=parseInt(c,10)||0,d+=c);return d},c.prototype.setupContent=function(a,b){var c,d=document.getElementById("content-container"),e=d.style,f=this.contentRulers;a.length>1?(c=a[0],e.paddingLeft=c.flexible?"0":c.size+"px"):e.paddingLeft=0,a.length>2?(c=a[a.length-1],e.paddingRight=c.flexible?"0":c.size+"px"):e.paddingRight=0,b.length>1?(c=b[0],e.paddingTop=c.flexible?"0":c.size+"px"):e.paddingTop=0,b.length>2?(c=b[b.length-1],e.paddingBottom=c.flexible?"0":c.size+"px"):e.paddingBottom=0,f.querySelector("tr:first-child").style.height=e.paddingTop,f.querySelector("tr:last-child").style.height=e.paddingBottom,f.querySelector("tr:last-child td:first-child").style.width=e.paddingLeft,f.querySelector("tr:last-child td:last-child").style.width=e.paddingRight},c.prototype.destroy=function(){this.previewContainer.innerHTML=""},c}(),SimpleResize=function(){"use strict";function a(a,b){var c=this;this.handler=a,this.initialParams={x:0,y:0,maxWidth:0},this.eventBounds={mouseMove:c.onDrag.bind(c),mouseUp:c.stopDrag.bind(c),mouseDown:c.initDrag.bind(c)},this.container=b}return a.prototype.init=function(){this.bindEvents()},a.prototype.initDrag=function(){var a=this.eventBounds,b=document.body.clientWidth,c=this.container.parentElement.clientWidth;this.initialParams.maxWidth=c,this.initialParams.offsetWidth=(b-c)/2,document.addEventListener("mousemove",a.mouseMove,!1),document.addEventListener("mouseup",a.mouseUp,!1)},a.prototype.onDrag=function(a){var b,c=this.handler.style,d=this.initialParams;a.preventDefault(),b=(a.clientX-d.offsetWidth)/d.maxWidth,.5>b&&(b=.5),b>1&&(b=1),c.left=100*b+"%",this.container.style.width=100*(2*b-1)+"%"},a.prototype.stopDrag=function(a){var b=this.eventBounds;a.preventDefault(),document.removeEventListener("mousemove",b.mouseMove,!1),document.removeEventListener("mouseup",b.mouseUp,!1)},a.prototype.bindEvents=function(){var a=this.eventBounds;this.handler.addEventListener("mousedown",a.mouseDown,!1)},a}();document.addEventListener("DOMContentLoaded",function(){"use strict";var a,b,c,d,e=document.getElementById("upload-button"),f=document.getElementById("preview-container"),g=new Image;g.onload=function(){b=new NinePatch(this,f)},g.src="img/preview.bubble.9.png",d={element:e,dropZoneContainer:document.querySelector(".drop-zone"),documentMain:document.querySelector("main")},a=new ImageLoader(d,function(a){b instanceof NinePatch&&b.destroy(),b=new NinePatch(a,f),document.getElementById("content-container").innerText="Once you call it in, the people who show up with be with the office of medical investigations. it's primarily who you'll talk to. Policeofficers may arrive they may not, depends on how busy a morningthey're having. Typically ODs are not a high priority call. There'snothing here to incriminate you, so I'd be amazed if you got placedunder arrest. However, if you do, you say nothing. You tell them youjust want your lawyer. And you call Saul Goodman."},function(a){console.log(a)}),a.init(),c=new SimpleResize(document.querySelector(".resize-handler"),document.querySelector(".nine-patch-preview")),c.init()});